@model ProjectWebApp.Models.PRESUPUESTO
    @using ProjectWebApp.Models

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_LayoutPrincipal.cshtml";
}


<div class="page-title">
    <div class="title_left">
        <h3>Gestion de Casos</h3>
    </div>

    <div class="title_right" style="display:none">
        <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search for...">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">Go!</button>
                </span>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>

<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2>Asignacion de Casos<small></small></h2>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <form class="form-horizontal form-label-left" method="post" id="formsubmit">


                    @Html.AntiForgeryToken()
                    <!--<span class="section">Modificacion de Campos</span>-->
                    <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="textarea">
                            Corporativo <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            @Html.DropDownList("ID_ASISTENTE", (IEnumerable<SelectListItem>)ViewBag.Corporativos, "-- Seleccione Corporativo --", htmlAttributes: new { @class = "form-control col-md-7 col-xs-12", required = "required" })
                        </div>
                    </div>
                    <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">
                            Nota a Cliente<span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            @Html.TextArea("NOTA",Model.NOTA, htmlAttributes: new { @class = "form-control col-md-7 col-xs-12", required = "required" })
                        </div>
                    </div>
                    <div class="ln_solid"></div>
                    <table id="datatable-checkbox" class="table table-striped table-bordered bulk_action">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="check-all" class="flat"></th>
                                <th>Categoria</th>
                                <th>Nombre</th>
                                <th>Valor</th>
                                <th>Codigo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="checkbox" class="flat" name="table_records"></td>
                                <td>Sin Informacion</td>
                                <td>Sin Informacion</td>
                                <td>Sin Informacion</td>
                                <td>Sin Informacion</td>
                            </tr>

                        </tbody>
                    </table>
                    <div class="form-group">
                        <div class="col-md-6 col-md-offset-3">
                            <button id="send" type="submit" class="btn btn-success">Guardar</button>
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">Asignados</button>
                        </div>
                    </div>
                </form>

                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">
                                    <span aria-hidden="true">×</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabel">Asignaciones</h4>
                            </div>
                            <div class="modal-body">
                                <h4>Tramites ya Efectuados</h4>
                                <p>Los tramites a continuacion ya fueron tomados y solicitados a las notarias pertinentes.</p>
                                <div class="x_panel">
                                    <div class="x_content">
                                        <p class="text-muted font-13 m-b-30">
                                            The Buttons extension for DataTables provides a common set of options, API methods and styling to display buttons on a page that will interact with a DataTable. The core library provides the based framework upon which plug-ins can built.
                                        </p>
                                        <table id="datatable-buttons" class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th><input type="checkbox" id="check-all" class="flat"></th>
                                                    <th>Nombre</th>
                                                    <th>Valor</th>
                                                    <th>Codigo</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.DETALLE_TRAMITES != null)
                                                {
                                                    foreach (DETALLE_TRAMITES item in Model.DETALLE_TRAMITES)
                                                    {
                                                        <tr>
                                                            <td><input type="checkbox" class="flat" name="table_records"></td>
                                                            <td>@item.NOMBRE_TRAMITE</td>
                                                            <td>@item.COSTO</td>
                                                            <td>@item.CODIGO_TRAMITE</td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr>
                                                        <td><input type="checkbox" class="flat" name="table_records"></td>
                                                        <td>Sin Informacion</td>
                                                        <td>Sin Informacion</td>
                                                        <td>Sin Informacion</td>
                                                    </tr>
                                                }



                                            </tbody>
                                        </table>
                                    </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                    </div>

                </div>
                <div class="actionBar">
                    @Html.ActionLink("Volver a Listado", "GestionAsistencia", null, new { @class = "buttonPrevious btn btn-primary" })
                </div>
            </div>
        </div>
    </div>
</div>
@section Stylescustom{
    <style>
        #wait {
            position: fixed;
            top: 0px;
            right: 0px;
            width: 100%;
            height: 100%;
            background-color: #666;
            background-image: url('ajax-loader.gif');
            background-repeat: no-repeat;
            background-position: center;
            z-index: 10000000;
            opacity: 0.4;
            filter: alpha(opacity=40); /* For IE8 and earlier */
        }
    </style>

}
@section Scripts{

    <!-- Datatables -->

    <script>

        $(document).ready(function () {
            var handleDataTableButtons = function () {
                if ($("#datatable-buttons").length) {
                    $("#datatable-buttons").DataTable({
                        dom: "Bfrtip",
                        buttons: [
                            {
                                extend: "copy",
                                className: "btn-sm"
                            },
                            {
                                extend: "csv",
                                className: "btn-sm"
                            },
                            {
                                extend: "excel",
                                className: "btn-sm"
                            },
                            {
                                extend: "pdfHtml5",
                                className: "btn-sm"
                            },
                            {
                                extend: "print",
                                className: "btn-sm"
                            },
                        ],
                        responsive: true
                    });
                }
            };

            TableManageButtons = function () {
                "use strict";
                return {
                    init: function () {
                        handleDataTableButtons();
                    }
                };
            }();
            retornameAjax();
            function retornameAjax() {
                $(document).ajaxStart(function () {
                    $("#wait").fadeIn();

                });
                $.ajax({
                    url: "https://apinotaria.azurewebsites.net/api/NOTARIA_TRAMITES",
                    async: true,
                    cache: false,
                    timeout: 60000,
                    method: "GET",
                    dataType: 'json',
                    success: function (result) {

                        var arr = [];
                        console.log(result);

                        $.each(result, function (k, v) {
                            arr.push([v.ID_TRAMITE, v.CATEGORIA, v.NOMBRE, v.VALOR, v.COD_TRAM]);
                        });

                        $('#datatable').dataTable();

                        $('#datatable-keytable').DataTable({
                            keys: true
                        });

                        $('#datatable-responsive').DataTable();

                        $('#datatable-scroller').DataTable({
                            ajax: "js/datatables/json/scroller-demo.json",
                            deferRender: true,
                            scrollY: 380,
                            scrollCollapse: true,
                            scroller: true
                        });

                        $('#datatable-fixed-header').DataTable({
                            fixedHeader: true
                        });

                        var $datatable = $('#datatable-checkbox');
                        $datatable.on('draw.dt', function () {
                            $('checkbox input, input[type="checkbox"]').iCheck({
                                checkboxClass: 'icheckbox_flat-green'
                            });
                        });
                        $datatable.DataTable({
                            data: arr,
                            deferRender: true,
                            scrollY: 200,
                            scrollCollapse: true,
                            scroller: true,
                            order: [[1, 'asc']],
                            columnDefs: [{
                                targets: 0,
                                searchable: false,
                                orderable: false,
                                className: 'flat',
                                render: function (data, type, full, meta) {
                                    console.log(full);
                                    return '<input type="checkbox" class="flat" rel=' + data + ' name="table_records,' + full + ' ">';
                                }
                            }]
                        });


                    },
                    error: function (xhr, ajaxOptions, thrownError){
                        
                        //alert(xhr.status);
                        $.ajax({
                            url: "https://apinotaria.azurewebsites.net/api/NOTARIA_TRAMITES",
                            async: true,
                            cache: false,
                            timeout: 60000,
                            method: "GET",
                            dataType: 'json',
                            success: function (result) {

                                var arr = [];
                                console.log(result);

                                $.each(result, function (k, v) {
                                    arr.push([v.ID_TRAMITE, v.CATEGORIA, v.NOMBRE, v.VALOR, v.COD_TRAM]);
                                });

                                $('#datatable').dataTable();

                                $('#datatable-keytable').DataTable({
                                    keys: true
                                });

                                $('#datatable-responsive').DataTable();

                                $('#datatable-scroller').DataTable({
                                    ajax: "js/datatables/json/scroller-demo.json",
                                    deferRender: true,
                                    scrollY: 380,
                                    scrollCollapse: true,
                                    scroller: true
                                });

                                $('#datatable-fixed-header').DataTable({
                                    fixedHeader: true
                                });

                                var $datatable = $('#datatable-checkbox');
                                $datatable.on('draw.dt', function () {
                                    $('checkbox input, input[type="checkbox"]').iCheck({
                                        checkboxClass: 'icheckbox_flat-green'
                                    });
                                });
                                $datatable.DataTable({
                                    data: arr,
                                    deferRender: true,
                                    scrollY: 200,
                                    scrollCollapse: true,
                                    scroller: true,
                                    order: [[1, 'asc']],
                                    columnDefs: [{
                                        targets: 0,
                                        searchable: false,
                                        orderable: false,
                                        className: 'flat',
                                        render: function (data, type, full, meta) {
                                            console.log(full);
                                            return '<input type="checkbox" class="flat" rel=' + data + ' name="table_records,' + full + ' ">';
                                        }
                                    }]
                                });


                            },
                            error: function (xhr, ajaxOptions, thrownError) {

                                //alert(xhr.status);

                                return (xhr.status);
                            }
                        });
                        return (xhr.status);
                    }
                });

                $(document).ajaxComplete(function () {
                    $("#wait").fadeOut();
                });
            }

        });
    </script>
    <!-- /Datatables -->


}
